mod error;

use async_trait::async_trait;
use cosmian_kmip::kmip::kmip_objects::Object;

pub use crate::error::{HsmError, HsmResult};
pub mod reexports {
    pub mod kmip {
        pub use cosmian_kmip::kmip::kmip_objects::Object;
    }
}

pub enum HsmAlgorithm {
    AES,
    RSA,
}

pub enum HsmObject {
    Any,
    AesKey,
    RsaKey,
    RsaPrivateKey,
    RsaPublicKey,
}

#[async_trait(?Send)]
pub trait Hsm {
    /// Create the given Object in the HSM.
    /// The Object ID will be generated by the HSM and returned.
    async fn create(
        &self,
        slot_id: usize,
        algorithm: HsmAlgorithm,
        key_length_in_bits: usize,
        label: &str,
    ) -> HsmResult<usize>;

    /// Retrieve objects from the HSN.
    async fn retrieve(&self, slot_id: usize, object_id: usize) -> HsmResult<Object>;

    /// Delete an object from the HSM.
    async fn delete(&self, slot_id: usize, object_id: usize) -> HsmResult<()>;

    /// Find objects in the HSM.
    async fn find(&self, slot_id: usize, object_type: HsmObject) -> HsmResult<Vec<String>>;
}
